Fisma.Finding={commentTable:null,POC_MESSAGE_CONTAINER_ID:"findingPocNotMatched",createPocPanel:null,createPocDefaultUsername:null,pocAutocomplete:null,pocHiddenEl:null,commentCallback:function(f,b){var d=this;var c={timestamp:f.createdTs,username:f.username,comment:f.comment};this.commentTable.addRow(c);this.commentTable.sortColumn(this.commentTable.getColumn(0),YAHOO.widget.DataTable.CLASS_DESC);var a=new Fisma.Blinker(100,6,function(){d.commentTable.highlightRow(0)},function(){d.commentTable.unhighlightRow(0)});a.start();var e=document.getElementById("findingCommentsCount").firstChild;e.nodeValue++;b.hide();b.destroy()},editEcdJustification:function(){var a=document.getElementById("currentChangeDescription");a.style.display="none";var c;if(a.firstChild){c=a.firstChild.nodeValue}else{c=""}var b=document.createElement("input");b.type="text";b.value=c;b.name="finding[ecdChangeDescription]";a.parentNode.appendChild(b)},showSecurityControlSearch:function(){var b=document.getElementById("securityControlSearchButton");b.style.display="none";var a=document.getElementById("findingSecurityControlSearch");a.style.display="block"},handleSecurityControlSelection:function(){var a=document.getElementById("securityControlContainer");a.innerHTML='<img src="/images/loading_bar.gif">';var c=document.getElementById("securityControlId");var b=escape(c.value);YAHOO.util.Connect.asyncRequest("GET","/security-control/single-control/id/"+b,{success:function(d){a.innerHTML=d.responseText},failure:function(d){Fisma.Util.showAlertDialog("Unable to load security control definition.")}})},setupPocAutocomplete:function(a,b){Fisma.Finding.pocAutocomplete=a;Fisma.Finding.pocHiddenEl=document.getElementById(b.hiddenFieldId);a.dataReturnEvent.subscribe(Fisma.Finding.displayPocNotFoundMessage);a.containerCollapseEvent.subscribe(Fisma.Finding.displayPocNotFoundMessage);a.itemSelectEvent.subscribe(Fisma.Finding.hidePocNotFoundMessage);a.containerExpandEvent.subscribe(Fisma.Finding.hidePocNotFoundMessage)},displayPocNotFoundMessage:function(d,b){var f=Fisma.Finding.pocAutocomplete;var c=b.length>=2?b[2]:null;if(YAHOO.lang.isValue(c)&&c.length!==0){Fisma.Finding.hidePocNotFoundMessage();return}if(d=="containerCollapse"&&f._bItemSelected){return}if(f.isContainerOpen()){return}var e=f.getInputEl().value;if(e.match(/^\s*$/)){return}var a=document.getElementById(Fisma.Finding.POC_MESSAGE_CONTAINER_ID);if(YAHOO.lang.isNull(a)){a=Fisma.Finding._createPocNotFoundContainer(Fisma.Finding.POC_MESSAGE_CONTAINER_ID,f.getInputEl().parentNode)}a.firstChild.nodeValue='No point of contact named "'+e+'" was found. Click here to create one.';a.style.display="block";Fisma.Finding.createPocDefaultUsername=e},_createPocNotFoundContainer:function(c,b){var a=document.createElement("div");YAHOO.util.Event.addListener(a,"click",Fisma.Finding.displayCreatePocForm);a.className="pocNotMatched";a.id=c;a.appendChild(document.createTextNode(""));b.appendChild(a);return a},hidePocNotFoundMessage:function(){var a=document.getElementById(Fisma.Finding.POC_MESSAGE_CONTAINER_ID);if(YAHOO.lang.isValue(a)){a.style.display="none"}},displayCreatePocForm:function(){var a={width:"50em",modal:true};Fisma.Finding.createPocPanel=Fisma.UrlPanel.showPanel("Create New Point Of Contact","/poc/form",Fisma.Finding.populatePocForm,"createPocPanel",a)},populatePocForm:function(){document.getElementById("msgbar").id="oldMessageBar";document.getElementById("pocMessageBar").id="msgbar";var usernameEl=document.getElementById("username");usernameEl.value=Fisma.Finding.createPocDefaultUsername;var scriptNodes=Fisma.Finding.createPocPanel.body.getElementsByTagName("script");for(var i=0;i<scriptNodes.length;i++){try{eval(scriptNodes[i].text)}catch(e){var message="Not able to execute one of the scripts embedded in this page: "+e.message;Fisma.Util.showAlertDialog(message)}}var tooltips=YAHOO.util.Dom.getElementsByClassName("yui-tt","div");for(var index in tooltips){var tooltip=tooltips[index];tooltip.style.zIndex=5}},createPoc:function(){var a=this;var b=Fisma.Finding.createPocPanel.body.getElementsByTagName("form")[0];a.set("disabled",true);var c=document.getElementById("username").value;YAHOO.util.Connect.setForm(b);YAHOO.util.Connect.asyncRequest("POST","/poc/create/format/json",{success:function(g){var d;try{d=YAHOO.lang.JSON.parse(g.responseText).result}catch(f){d={success:false,message:f}}if(d.success){Fisma.Finding.createPocPanel.hide();Fisma.Finding.hidePocNotFoundMessage();Fisma.Finding.pocAutocomplete._bItemSelected=true;var h=parseInt(d.message,10);Fisma.Finding.pocHiddenEl.value=h;Fisma.Finding.pocAutocomplete.getInputEl().value=c;document.getElementById("msgbar").id="pocMessageBar";document.getElementById("oldMessageBar").id="msgbar";message("A point of contact has been created.","info",true)}else{message(d.message,"warning",true);a.set("disabled",false)}},failure:function(e){var d="Failed to create new point of contact: "+e.statusText;Fisma.Finding.createPocPanel.setBody(d)}},null)},setupSecurityControlAutocomplete:function(a,b){a.itemSelectEvent.subscribe(Fisma.AutoComplete.handleSecurityControlSelection)}};